# إضافة بيانات المالك إلى قاعدة البيانات

هذا الدليل يوضح كيفية إضافة بيانات المالك الأولي إلى قاعدة البيانات في نظام إبراهيم للمحاسبة.

## ⚠️ مهم: الترتيب الصحيح

**يجب تشغيل الملفات بالترتيب التالي:**

1. **أولاً**: `create-tables.sql` - لإنشاء الجداول
2. **ثانياً**: `init-database.sql` - لإضافة البيانات الأولية

## الطرق المتاحة

### 1. استخدام واجهة المستخدم (الأسهل)

قم بتشغيل التطبيق وانتقل إلى صفحة إضافة المالك:

```bash
pnpm dev
```

ثم افتح المتصفح على: `http://localhost:5173/add-owner`

### 2. استخدام سكريبت Node.js

```bash
# تأكد من إضافة متغير البيئة للمفتاح السري
export SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# تشغيل السكريبت
pnpm init-db
```

### 3. استخدام ملفات SQL مباشرة

**الخطوة الأولى - إنشاء الجداول:**
1. اذهب إلى [Supabase Dashboard](https://supabase.com/dashboard)
2. اختر مشروعك
3. اذهب إلى SQL Editor
4. انسخ محتوى ملف `create-tables.sql` وضعه في المحرر
5. اضغط "Run" لإنشاء الجداول

**الخطوة الثانية - إضافة البيانات:**
1. في نفس SQL Editor
2. انسخ محتوى ملف `init-database.sql` وضعه في المحرر
3. اضغط "Run" لإضافة البيانات الأولية

## البيانات الافتراضية

### بيانات المتجر
- **اسم المتجر**: متجر إبراهيم للمحاسبة
- **اسم المالك**: إبراهيم أحمد
- **البريد الإلكتروني**: ibrahim@example.com
- **رقم الهاتف**: +966501234567
- **العنوان**: الرياض، المملكة العربية السعودية
- **خطة الاشتراك**: سنوي

### بيانات المستخدم المالك
- **اسم المستخدم**: ibrahim_owner
- **البريد الإلكتروني**: ibrahim@example.com
- **كلمة السر**: Ibrahim123!
- **الاسم الكامل**: إبراهيم أحمد
- **الدور**: owner (مالك)

## الصلاحيات الممنوحة للمالك

المالك يحصل على جميع الصلاحيات التالية:

### إدارة المستخدمين
- ✅ إنشاء مستخدمين جدد
- ✅ عرض المستخدمين
- ✅ تعديل بيانات المستخدمين
- ✅ حذف المستخدمين

### إدارة الفواتير
- ✅ إنشاء فواتير جديدة
- ✅ عرض الفواتير
- ✅ تعديل الفواتير
- ✅ حذف الفواتير

### إدارة المخزون
- ✅ إضافة منتجات جديدة
- ✅ عرض المنتجات
- ✅ تعديل المنتجات
- ✅ حذف المنتجات

### إدارة الموظفين
- ✅ إضافة موظفين جدد
- ✅ عرض الموظفين
- ✅ تعديل بيانات الموظفين
- ✅ حذف الموظفين

### إدارة الرواتب
- ✅ إنشاء كشوف رواتب
- ✅ عرض كشوف الرواتب
- ✅ تعديل كشوف الرواتب
- ✅ حذف كشوف الرواتب

### التقارير والإعدادات
- ✅ عرض التقارير
- ✅ تعديل إعدادات النظام
- ✅ تعديل إعدادات المتجر

## البيانات الافتراضية المضافة

### العملات
- الريال السعودي (SAR)
- الدولار الأمريكي (USD)
- اليورو (EUR)
- الدرهم الإماراتي (AED)

### فئات الفواتير
- مشتريات
- مبيعات
- خدمات
- مصروفات
- إيرادات

### فئات المخزون
- إلكترونيات
- ملابس
- أدوات منزلية
- كتب ومكتبة
- أخرى

### وحدات القياس
- قطعة
- كيلوغرام
- غرام
- لتر
- متر
- صندوق
- حزمة

## ملاحظات مهمة

1. **كلمة السر**: يتم تشفير كلمة السر باستخدام bcrypt مع salt rounds = 12
2. **التحقق من التكرار**: السكريبت يتحقق من عدم وجود المستخدم أو المتجر مسبقاً
3. **التراجع**: في حالة فشل إنشاء المستخدم، يتم حذف المتجر تلقائياً
4. **الأمان**: احفظ بيانات تسجيل الدخول في مكان آمن

## استكشاف الأخطاء

### خطأ: "relation 'stores' does not exist"
- **الحل**: يجب تشغيل `create-tables.sql` أولاً لإنشاء الجداول
- تأكد من تشغيل الملفات بالترتيب الصحيح

### خطأ: "currencies_code_check constraint violation"
- **الحل**: تأكد من إضافة `store_id` عند إدراج العملات
- تم إصلاح هذه المشكلة في الملفات المحدثة

### خطأ: "المستخدم موجود مسبقاً"
- تأكد من عدم وجود مستخدم بنفس اسم المستخدم
- أو قم بتغيير اسم المستخدم

### خطأ: "المتجر موجود مسبقاً"
- تأكد من عدم وجود متجر بنفس البريد الإلكتروني
- أو قم بتغيير البريد الإلكتروني

### خطأ: "SUPABASE_SERVICE_ROLE_KEY is required"
- أضف متغير البيئة للمفتاح السري لـ Supabase
- يمكنك الحصول عليه من Supabase Dashboard > Settings > API

## الدعم

إذا واجهت أي مشاكل، تأكد من:
1. صحة إعدادات Supabase
2. وجود جميع الجداول المطلوبة في قاعدة البيانات
3. صحة المفاتيح والصلاحيات
